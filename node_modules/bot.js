const Http = require('http');
const Fs = require('fs');
const Discord = require('discord.js');

var downloadAvatar = function(link) {
    if (link.split(':')[0] == 'https') { //Converting https link to http link
        tmpTab = link.split(':');
        tmpTab[0] = 'http';
        link = tmpTab.join(':');
        console.log('Corrected link: ' + link);
    }

    splitLink = link.split('/');
    fileName = splitLink[splitLink.length - 1]; // Last element of splitted with '/' string is the file name
    
    splitFileName = fileName.split('.'); // File name's extension
    extension = tmpTab[tmpTab.length - 1]; // File name's extension

    console.log('Found filename: ' + fileName);
    if (splitFileName[splitFileName.length - 1] == 'png') { // getting file's extension
        var file = Fs.createWriteStream('avatar.png');
        var request = Http.get(link, function(response) {
            response.pipe(file);
        });
    } else {
        console.log('Leger fail, je crois...');
    }
}

var replyCmd = function(message) {
    splittedCmd = message.content.split(' ');

    if (splittedCmd[0] == '/cmd') {
        if (splittedCmd[1] == 'help') {
            message.reply(
"\nhelp: Affiche commandes disponibles\n\
ping: Répond 'pong'\n"
                        );

        } else if (splittedCmd[1] == 'ping') {
            message.channel.send('pong')
        } else if(splittedCmd[1] == 'disconnect') {
            client.destroy();
        } else {
            message.reply('MAIS ESPÈCE D\'ENCULÉ ÉCRIS CORRECTEMENT LÀ');
        }
    }
}


exports.downloadAvatar = downloadAvatar;
exports.replyCmd = replyCmd;