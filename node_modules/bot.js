const Public = require('public');
const Fs = require('fs');
const Bot = require('bot');
const Discord = require('discord.js');
const ErrorMessages = require('insultes');

var answered = false;
var response = '';
var reponseCmd = function(message) {
    console.log('Received: ' + message.content);

    splittedCmd = message.content.split(' ');

    response = "";
    answered = false;

    if (splittedCmd[0] == '/cmd') {
        if (splittedCmd[1] == 'help') {
           response = "```Markdown\nhelp: Affiche commandes disponibles\n\
ping: Répond 'pong'\n\
link: donne le lien de l'avatar de l'auteur\n\
random <min> <max>: générer un nombre entre min et max\n\```";

        } else if (splittedCmd[1] == 'ping') {
            response = "pong";
        
        } else if(splittedCmd[1] == 'link') {
            response = new MessageAttachment(message.author.avatarURL);
        
        } else if(splittedCmd[1] == 'random') {
            if (splittedCmd.length == 4) { // La commande devrait contenir 4 éléments (/cmd random <min> <max>)
                if (Number(splittedCmd[2]) != NaN && Number(splittedCmd[3] != NaN)) {
                    response = randrange(Number(splittedCmd[2]), Number(splittedCmd[3]));
                } else {
                    response = 'ENTRE DES NOMBRES SALOPE(et pas du texte) !';
                }
            } else {
                response = 'MAIS GROS PD TU SAIS PAS ÉCRIRE OÙ QUOI ?\nSYNTAXE: /cmd random <min> <max>';
            }

        } else {
            response = getError("UNFOUND");
            console.log("Unfound : " + response);
        }

        if (!answered) {
            message.reply(response);
            response = '';
            answered = true;
        }
        
    }
}

var getError = function(categorie) { //Renvoie une insulte
    return ErrorMessages["ERREURS"][categorie][randrange(0, ErrorMessages["ERREURS"][categorie].length)];
}

var randrange = function(min, max) {
    return Math.floor(Math.random() * max) + min;
}


exports.getError = getError;
exports.reponseCmd = reponseCmd;
exports.randrange = randrange;